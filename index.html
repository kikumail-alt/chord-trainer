<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Chord Trainer</title>

<style>
body {
  font-family: system-ui, sans-serif;
  padding: 24px;
  background-color: #ffffff;
  color: #000000;
}

h1 {
  margin: 0 0 12px;
}

.row {
  display: flex;
  gap: 12px;
  align-items: center;
  flex-wrap: wrap;
}

button {
  padding: 8px 12px;
  font-size: 14px;
  cursor: pointer;
}

input[type="range"] {
  width: 200px;
}

.chord {
  font-size: 56px;
  font-weight: 800;
  margin: 12px 0 8px;
}

.panel {
  margin-top: 18px;
  padding: 14px;
  border: 1px solid #ccc;
  border-radius: 12px;
}

.panel h2 {
  font-size: 16px;
  margin: 0 0 10px;
}

.grid2 {
  display: grid;
  grid-template-columns: 1fr;
  gap: 12px;
}

@media (min-width: 900px) {
  .grid2 {
    grid-template-columns: 1fr 1fr;
  }
}

.checks {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
  gap: 6px 10px;
}

.checks label {
  display: flex;
  gap: 8px;
  align-items: center;
  user-select: none;
}

.warn {
  color: #b00020;
  margin-top: 6px;
  display: none;
}

.fbCard {
  border: 1px solid #ccc;
  border-radius: 12px;
  padding: 10px;
}

.sub {
  font-size: 13px;
  color: #555;
  margin-top: 6px;
}

.mono {
  font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
}

/* ===== ãƒ†ãƒ¼ãƒåˆ‡æ›¿ ===== */
.theme-switch {
  position: fixed;
  top: 12px;
  right: 12px;
  display: flex;
  gap: 6px;
  z-index: 1000;
}

/* ===== ç™½é»’åè»¢ ===== */
body.theme-dark {
  background-color: #111111;
  color: #eeeeee;
}

body.theme-dark .panel,
body.theme-dark .fbCard {
  background-color: #1a1a1a;
  border-color: #444;
}

body.theme-dark button {
  background-color: #222222;
  color: #eeeeee;
  border: 1px solid #555;
}

body.theme-dark .sub {
  color: #cfcfcf;
}

body.theme-dark svg {
  filter: invert(1) hue-rotate(180deg);
}

/* ===== ä½ã‚³ãƒ³ãƒˆãƒ©ã‚¹ãƒˆï¼ˆç›®ã«å„ªã—ã„ï¼‰ ===== */
body.theme-low {
  background-color: #2a2a2a;
  color: #dddddd;
}

body.theme-low .panel,
body.theme-low .fbCard {
  background-color: #3a3a3a;
  border-color: #666;
}

body.theme-low button {
  background-color: #444;
  color: #f0f0f0;
  border: 1px solid #666;
}

body.theme-low .sub {
  color: #d7d7d7;
}
  
/* ===== Start / Stop çŠ¶æ…‹è¡¨ç¤º ===== */
button.is-active {
  background-color: #2e7d32;
  color: #ffffff;
  border: 2px solid #1b5e20;
}

button.is-stop {
  background-color: #b00020;
  color: #ffffff;
  border: 2px solid #7f0015;
}

body.theme-dark button.is-active {
  background-color: #4caf50;
  border-color: #2e7d32;
}

body.theme-dark button.is-stop {
  background-color: #e53935;
  border-color: #ab000d;
}

body.theme-low button.is-active {
  background-color: #5fa96a;
  border-color: #3f7f4a;
}

body.theme-low button.is-stop {
  background-color: #d06a6a;
  border-color: #9a3f3f;
}
body.theme-low button {
  background-color: #3a3a3a;
  color: #eeeeee;
}

/* â† ã“ã®ä¸‹ã«è¿½åŠ  */
footer.copyright {
  margin-top: 32px;
  text-align: center;
  font-size: 12px;
  color: #777;
}

body.theme-dark footer.copyright {
  color: #aaa;
}

body.theme-low footer.copyright {
  color: #bbb;
}
  
</style>
</head>

<body>

<div class="theme-switch">
  <button data-theme="normal">â˜€ï¸ é€šå¸¸</button>
  <button data-theme="dark">ğŸŒ™ ç™½é»’åè»¢</button>
  <button data-theme="low">ğŸŒ˜ ä½ã‚³ãƒ³ãƒˆãƒ©ã‚¹ãƒˆ</button>
</div>

<h1>Chord Trainer</h1>

<div class="row">
  <label>è¡¨ç¤ºç§’æ•° <span id="secLabel">3</span> ç§’</label>
  <input id="sec" type="range" min="1" max="10" value="3">
  <label><input type="checkbox" id="random" checked> ãƒ©ãƒ³ãƒ€ãƒ </label>
</div>

<div class="chord" id="chord">C</div>

<div class="fbCard" id="fretboard"></div>
<div class="sub mono" id="shapeText"></div>
<div class="sub">è¡¨ç¤ºã¯ã€Œä¸Šï¼1å¼¦ï¼ˆç´°ã„Eï¼‰ / ä¸‹ï¼6å¼¦ï¼ˆå¤ªã„Eï¼‰ã€ã§ã™ã€‚</div>

<div class="row" style="margin-top:10px;">
  <button id="start">Start</button>
  <button id="stop" disabled>Stop</button>
  <button id="next">Next</button>
</div>

<div class="panel">
  <h2>ãƒ«ãƒ¼ãƒˆï¼ˆCã€œBï¼‰Ã— ç¨®é¡ï¼ˆMajor / 7 / M7 / m / m7 / dim / dim7 / sus4ï¼‰</h2>

  <div class="grid2">
    <div>
      <div class="row" style="margin-bottom:8px;">
        <strong>ãƒ«ãƒ¼ãƒˆï¼ˆã‚­ãƒ¼ï¼‰</strong>
        <button id="rootsAll" type="button">å…¨é¸æŠ</button>
        <button id="rootsNone" type="button">å…¨è§£é™¤</button>
      </div>
      <div class="checks" id="rootChecks"></div>
    </div>

    <div>
      <div class="row" style="margin-bottom:8px;">
        <strong>ç¨®é¡</strong>
        <button id="qualAll" type="button">å…¨é¸æŠ</button>
        <button id="qualNone" type="button">å…¨è§£é™¤</button>
      </div>
      <div class="checks" id="qualChecks"></div>
    </div>
  </div>

  <div class="warn" id="warn">âš ï¸ ãƒ«ãƒ¼ãƒˆã¨ç¨®é¡ã‚’1ã¤ä»¥ä¸Šé¸ã‚“ã§ãã ã•ã„</div>
</div>

<script>
/* ===== ãƒ«ãƒ¼ãƒˆï¼ˆ# / â™­è¡¨è¨˜ã¯æ•™ç§‘æ›¸è¡¨ã«åˆã‚ã›ãŸè¦‹ãŸç›®ï¼‰ ===== */
const ROOTS = [
  {label:"C",      idx:0},
  {label:"C#/Db",  idx:1},
  {label:"D",      idx:2},
  {label:"D#/Eb",  idx:3},
  {label:"E",      idx:4},
  {label:"F",      idx:5},
  {label:"F#/Gb",  idx:6},
  {label:"G",      idx:7},
  {label:"G#/Ab",  idx:8},
  {label:"A",      idx:9},
  {label:"A#/Bb",  idx:10},
  {label:"B",      idx:11},
];

/* ===== ç¨®é¡ï¼ˆæ•™ç§‘æ›¸è¡¨ã®è¡Œï¼‰ ===== */
const QUALS = [
  {key:"Maj",  label:"Major", suffix:""},
  {key:"7",    label:"7",     suffix:"7"},
  {key:"M7",   label:"M7",    suffix:"M7"},
  {key:"m",    label:"m",     suffix:"m"},
  {key:"m7",   label:"m7",    suffix:"m7"},
  {key:"dim",  label:"dim",   suffix:"dim"},
  {key:"dim7", label:"dim7",  suffix:"dim7"},
  {key:"sus4", label:"sus4",  suffix:"sus4"},
];

/* ===== æŠ¼ã•ãˆæ–¹ï¼šã¾ãšã¯é–‹æ”¾ã‚³ãƒ¼ãƒ‰ã®â€œä»£è¡¨â€ã‚’å„ªå…ˆã€ç„¡ã„ã‚‚ã®ã¯ç§»èª¿å¼ï¼ˆãƒãƒ¬ãƒ¼ï¼‰ =====
   frets: 6å¼¦â†’1å¼¦, -1=ãƒŸãƒ¥ãƒ¼ãƒˆ, 0=é–‹æ”¾, 1+=ãƒ•ãƒ¬ãƒƒãƒˆ
*/
const OPEN_SHAPES = {
  "C":    [-1,3,2,0,1,0],
  "C7":   [-1,3,2,3,1,0],
  "CM7":  [-1,3,2,0,0,0],

  "D":    [-1,-1,0,2,3,2],
  "D7":   [-1,-1,0,2,1,2],
  "DM7":  [-1,-1,0,2,2,2],
  "Dm":   [-1,-1,0,2,3,1],
  "Dm7":  [-1,-1,0,2,1,1],
  "Dsus4":[-1,-1,0,2,3,3],

  "E":    [0,2,2,1,0,0],
  "E7":   [0,2,0,1,0,0],
  "EM7":  [0,2,1,1,0,0],
  "Em":   [0,2,2,0,0,0],
  "Em7":  [0,2,0,0,0,0],
  "Esus4":[0,2,2,2,0,0],

  "F":    [1,3,3,2,1,1],
  "F7":   [1,3,1,2,1,1],
  "FM7":  [1,3,2,2,1,0],
  "Fm":   [1,3,3,1,1,1],
  "Fsus4":[1,3,3,3,1,1],

  "G":    [3,2,0,0,0,3],
  "G7":   [3,2,0,0,0,1],
  "GM7":  [3,2,0,0,0,2],
  "Gm":   [3,5,5,3,3,3],
  "Gsus4":[3,3,0,0,1,3],

  "A":    [-1,0,2,2,2,0],
  "A7":   [-1,0,2,0,2,0],
  "AM7":  [-1,0,2,1,2,0],
  "Am":   [-1,0,2,2,1,0],
  "Am7":  [-1,0,2,0,1,0],
  "Asus4":[-1,0,2,2,3,0],
  
  "B":    [-1,2,4,4,4,2],  // B Major : X 2 4 4 4 2
  "Bm":   [-1,2,4,4,3,2],  // B Minor : X 2 4 4 3 2
  "B7":   [-1,2,1,2,0,2],
};

/* ===== ç§»èª¿å¼ï¼ˆãƒãƒ¬ãƒ¼ï¼‰ãƒ†ãƒ³ãƒ—ãƒ¬ï¼šEå½¢ï¼ˆ6å¼¦ãƒ«ãƒ¼ãƒˆï¼‰ ===== */
function eShape(rootFret, kindKey) {
  // rootFret ã¯6å¼¦ã®ãƒ«ãƒ¼ãƒˆä½ç½®ï¼ˆE=0, F=1, ...ï¼‰
  const n = rootFret;
  if (kindKey === "Maj")  return [n, n+2, n+2, n+1, n,   n  ];
  if (kindKey === "m")    return [n, n+2, n+2, n,   n,   n  ];
  if (kindKey === "7")    return [n, n+2, n,   n+1, n,   n  ];
  if (kindKey === "m7")   return [n, n+2, n,   n,   n,   n  ];
  if (kindKey === "M7")   return [n, n+2, n+1, n+1, n,   n  ];
  if (kindKey === "sus4") return [n, n+2, n+2, n+2, n,   n  ];

  // dim / dim7ï¼šç·´ç¿’ç”¨ã®ã€Œå‹•ãå½¢ï¼ˆç°¡æ˜“ï¼‰ã€ã‚’æ¡ç”¨ï¼ˆä¸Š3ã€œ4å¼¦ä¸­å¿ƒï¼‰
  // dim:   6å¼¦rootã€5å¼¦+1ã€4å¼¦+2ã€3å¼¦rootï¼ˆãã‚Œä»¥å¤–ãƒŸãƒ¥ãƒ¼ãƒˆï¼‰
  if (kindKey === "dim")  return [n, n+1, n+2, n,  -1, -1];
  // dim7:  6å¼¦rootã€5å¼¦+1ã€4å¼¦+2ã€3å¼¦+1ï¼ˆãã‚Œä»¥å¤–ãƒŸãƒ¥ãƒ¼ãƒˆï¼‰
  if (kindKey === "dim7") return [n, n+1, n+2, n+1,-1, -1];

  return null;
}

/* ===== 6å¼¦ã®ãƒ«ãƒ¼ãƒˆä½ç½®ï¼ˆEåŸºæº–ï¼‰ ===== */
function rootFretOn6th(rootIdx) {
  // E(4)=0, F(5)=1 ... D#(3)=11
  // rootIdx: C=0 ... B=11
  // 6å¼¦é–‹æ”¾Eã¯ idx=4
  let f = rootIdx - 4;
  while (f < 0) f += 12;
  return f; // 0..11
}

/* ===== é¸æŠçŠ¶æ…‹ ===== */
let selectedRoots = new Set(ROOTS.map(r => r.idx));
let selectedQuals = new Set(QUALS.map(q => q.key));

let index = 0;
let timerId = null;
let intervalSec = 3;

/* ===== DOM ===== */
const chordEl = document.getElementById("chord");
const fretboardEl = document.getElementById("fretboard");
const shapeTextEl = document.getElementById("shapeText");
const warnEl = document.getElementById("warn");

const secEl = document.getElementById("sec");
const secLabel = document.getElementById("secLabel");

const startBtn = document.getElementById("start");
const stopBtn = document.getElementById("stop");
const nextBtn = document.getElementById("next");
const randomEl = document.getElementById("random");

/* ===== ãƒ†ãƒ¼ãƒ ===== */
const THEME_KEY = "chord_trainer_theme";
function applyTheme(t){
  document.body.classList.remove("theme-dark","theme-low");
  if(t==="dark") document.body.classList.add("theme-dark");
  if(t==="low")  document.body.classList.add("theme-low");
  renderCurrent();
}
applyTheme(localStorage.getItem(THEME_KEY) || "normal");
document.querySelectorAll(".theme-switch button").forEach(b=>{
  b.addEventListener("click", ()=>{
    const t = b.dataset.theme;
    localStorage.setItem(THEME_KEY, t);
    applyTheme(t);
  });
});

/* ===== ãƒ«ãƒ¼ãƒˆÃ—ç¨®é¡ ã‹ã‚‰ã€Œå‡ºé¡Œãƒªã‚¹ãƒˆã€ç”Ÿæˆ ===== */
function buildQueue() {
  const roots = ROOTS.filter(r => selectedRoots.has(r.idx));
  const quals = QUALS.filter(q => selectedQuals.has(q.key));

  const queue = [];
  for (const r of roots) {
    for (const q of quals) {
      queue.push({ root:r, qual:q });
    }
  }
  return queue;
}

/* ===== è¡¨ç¤ºåï¼ˆæ•™ç§‘æ›¸ã£ã½ãï¼‰ ===== */
function chordName(item) {
  return item.root.label + item.qual.suffix;
}

/* ===== æŠ¼ã•ãˆæ–¹ã‚’å–å¾— ===== */
function getFingering(item) {
  const name = chordName(item);

  // ã¾ãšé–‹æ”¾ã‚³ãƒ¼ãƒ‰ï¼ˆä»£è¡¨å½¢ï¼‰ãŒã‚ã‚Œã°ãã‚Œã‚’å„ªå…ˆ
  if (OPEN_SHAPES[name]) return OPEN_SHAPES[name];

  // ãã‚Œä»¥å¤–ã¯ç§»èª¿å¼ï¼ˆEå½¢ãƒãƒ¬ãƒ¼ï¼‰
  const fret = rootFretOn6th(item.root.idx);
  return eShape(fret, item.qual.key);
}

/* ===== æŒ‡æ¿æç”»ï¼ˆé–‹å§‹ãƒ•ãƒ¬ãƒƒãƒˆå¯¾å¿œ / ä½ã‚³ãƒ³ãƒˆãƒ©ã‚¹ãƒˆå¯¾å¿œï¼‰ ===== */
function computeBaseFret(frets) {
  const pos = frets.filter(v => v > 0);
  if (pos.length === 0) return 1;
  const min = Math.min(...pos);
  const max = Math.max(...pos);
  // 1ã€œ5ã«åã¾ã‚‹ãªã‚‰é–‹æ”¾åŸºæº–è¡¨ç¤º
  if (max <= 5) return 1;
  // ãã‚Œä»¥å¤–ã¯æœ€å°ãƒ•ãƒ¬ãƒƒãƒˆã‚’é–‹å§‹ã«
  return min;
}

function drawFretboard(frets, titleText) {
  const isLow = document.body.classList.contains("theme-low");
  const lineColor = isLow ? "#d0d0d0" : "#000000";
  const dotColor  = isLow ? "#f5f5f5" : "#000000";
  const textColor = isLow ? "#f5f5f5" : "#000000";

  const base = computeBaseFret(frets);
  const fretCount = 6;

  const W = 760, H = 190;
  const padL = 64, padR = 18, padT = 34, padB = 22;
  const gridW = W - padL - padR;
  const gridH = H - padT - padB;

  const stringCount = 6;
  const fretLines = fretCount + 1;
  const stringGap = gridH / (stringCount - 1);
  const fretGap = gridW / fretCount;

  const xForFretLine = (f) => padL + f * fretGap;
  // ä¸Šï¼1å¼¦ã€ä¸‹ï¼6å¼¦ï¼ˆä¸€èˆ¬çš„ï¼‰
  const yForString = (sIndex0) => padT + (5 - sIndex0) * stringGap; // sIndex0: 0..5 (6å¼¦..1å¼¦)

  const stringNames = ["E","A","D","G","B","E"]; // 6â†’1
  const dotR = 10;

  let svg = `<svg width="100%" viewBox="0 0 ${W} ${H}" role="img" aria-label="fretboard">`;

  svg += `<text x="10" y="20" font-size="16" font-weight="800" fill="${textColor}">${titleText}</text>`;

  // å¼¦
  for (let s=0;s<6;s++){
    const y = yForString(s);
    const sw = (s===0)?4:(s===1?3.2:(s===2?2.8:(s===3?2.4:(s===4?2.0:1.6))));
    svg += `<line x1="${padL}" y1="${y}" x2="${padL+gridW}" y2="${y}" stroke="${lineColor}" stroke-width="${sw}"/>`;
  }

    // ãƒ•ãƒ¬ãƒƒãƒˆç•ªå·ï¼ˆ6å¼¦ã®ä¸‹ã«è¡¨ç¤ºï¼‰
  const yBottom = yForString(0) + 22; // 6å¼¦(=sIndex0=0)ã®å°‘ã—ä¸‹
  for (let rel = 0; rel < fretCount; rel++) {
    const x1 = xForFretLine(rel);
    const x2 = xForFretLine(rel + 1);
    const cx = (x1 + x2) / 2;
    const num = base + rel;
    svg += `<text x="${cx}" y="${yBottom}" font-size="12" text-anchor="middle" fill="${textColor}">${num}</text>`;
  }

  // ãƒ•ãƒ¬ãƒƒãƒˆç¸¦ç·š
  for (let f=0; f<fretLines; f++){
    const x = xForFretLine(f);
    const sw = (f===0 && base===1) ? 8 : 2; // ãƒŠãƒƒãƒˆå¤ªç·š
    svg += `<line x1="${x}" y1="${padT}" x2="${x}" y2="${padT+gridH}" stroke="${lineColor}" stroke-width="${sw}"/>`;
  }

  // å¼¦åï¼ˆå·¦ï¼‰
  for (let s=0;s<6;s++){
    const y = yForString(s) + 5;
    svg += `<text x="${padL-22}" y="${y}" font-size="12" text-anchor="middle" fill="${textColor}">${stringNames[s]}</text>`;
  }

  // ãƒŸãƒ¥ãƒ¼ãƒˆ/é–‹æ”¾è¡¨ç¤ºï¼ˆå·¦ï¼‰
  for (let s=0;s<6;s++){
    const v = frets[s];
    const t = (v===-1) ? "x" : (v===0 ? "o" : "");
    if (!t) continue;
    const y = yForString(s) + 5;
    svg += `<text x="${padL-42}" y="${y}" font-size="14" font-weight="800" text-anchor="middle" fill="${textColor}">${t}</text>`;
  }

  // ãƒ‰ãƒƒãƒˆ
  for (let s=0;s<6;s++){
    const v = frets[s];
    if (v <= 0) continue;
    const rel = v - base; // 0..?
    if (rel < 0 || rel >= fretCount) continue;

    const x1 = xForFretLine(rel);
    const x2 = xForFretLine(rel+1);
    const cx = (x1+x2)/2;
    const cy = yForString(s);

    svg += `<circle cx="${cx}" cy="${cy}" r="${dotR}" fill="${dotColor}"/>`;
  }

  svg += `</svg>`;
  fretboardEl.innerHTML = svg;
}

/* ===== ç¾åœ¨è¡¨ç¤º ===== */
function renderCurrent() {
  const queue = buildQueue();
  if (queue.length === 0) {
    warnEl.style.display = "block";
    chordEl.textContent = "â€”";
    fretboardEl.innerHTML = "";
    shapeTextEl.textContent = "";
    return;
  }
  warnEl.style.display = "none";

  index = index % queue.length;
  const item = queue[index];

  const name = chordName(item);
  chordEl.textContent = name;

  const frets = getFingering(item);
  drawFretboard(frets, name);

  shapeTextEl.textContent = "æŠ¼ã•ãˆæ–¹(6â†’1): " + frets.map(v => v<0 ? "x" : String(v)).join(" ");
}

/* ===== æ¬¡ã¸ ===== */
function stepNext() {
  const queue = buildQueue();
  if (queue.length === 0) { renderCurrent(); return; }

  if (randomEl.checked) {
    let next = Math.floor(Math.random() * queue.length);
    if (queue.length > 1) {
      while (next === index) next = Math.floor(Math.random() * queue.length);
    }
    index = next;
  } else {
    index = (index + 1) % queue.length;
  }
  renderCurrent();
}

/* ===== ç§’æ•° ===== */
secEl.addEventListener("input", (e)=>{
  intervalSec = Number(e.target.value);
  secLabel.textContent = intervalSec;
  if (timerId) {
    clearInterval(timerId);
    timerId = setInterval(stepNext, intervalSec*1000);
  }
});

/* ===== Start/Stop/Nextï¼ˆStopãŒå¿…ãšåŠ¹ãç‰ˆï¼‰ ===== */
startBtn.addEventListener("click", ()=>{
  if (timerId) return;

  timerId = setInterval(stepNext, intervalSec * 1000);

  startBtn.disabled = true;
  stopBtn.disabled = false;

  // â˜… è¦‹ãŸç›®ã‚’ã€Œå†ç”Ÿä¸­ã€ã«
  startBtn.classList.add("is-active");
  stopBtn.classList.remove("is-stop");
});

stopBtn.addEventListener("click", ()=>{
  if (!timerId) return;

  clearInterval(timerId);
  timerId = null;

  startBtn.disabled = false;
  stopBtn.disabled = true;

  // â˜… è¦‹ãŸç›®ã‚’ã€Œåœæ­¢ä¸­ã€ã«
  startBtn.classList.remove("is-active");
  stopBtn.classList.add("is-stop");
});

nextBtn.addEventListener("click", ()=>{
  stepNext();
});

/* ===== ãƒã‚§ãƒƒã‚¯UIæç”» ===== */
const rootChecksEl = document.getElementById("rootChecks");
const qualChecksEl = document.getElementById("qualChecks");

function renderRootChecks() {
  rootChecksEl.innerHTML = "";
  for (const r of ROOTS) {
    const label = document.createElement("label");
    const cb = document.createElement("input");
    cb.type = "checkbox";
    cb.checked = selectedRoots.has(r.idx);
    cb.addEventListener("change", ()=>{
      if (cb.checked) selectedRoots.add(r.idx);
      else selectedRoots.delete(r.idx);
      index = 0;
      renderCurrent();
      if (timerId && buildQueue().length === 0) stopBtn.click();
    });
    label.appendChild(cb);
    label.appendChild(document.createTextNode(r.label));
    rootChecksEl.appendChild(label);
  }
}

function renderQualChecks() {
  qualChecksEl.innerHTML = "";
  for (const q of QUALS) {
    const label = document.createElement("label");
    const cb = document.createElement("input");
    cb.type = "checkbox";
    cb.checked = selectedQuals.has(q.key);
    cb.addEventListener("change", ()=>{
      if (cb.checked) selectedQuals.add(q.key);
      else selectedQuals.delete(q.key);
      index = 0;
      renderCurrent();
      if (timerId && buildQueue().length === 0) stopBtn.click();
    });
    label.appendChild(cb);
    label.appendChild(document.createTextNode(q.label));
    qualChecksEl.appendChild(label);
  }
}

/* ===== å…¨é¸æŠ/å…¨è§£é™¤ ===== */
document.getElementById("rootsAll").addEventListener("click", ()=>{
  selectedRoots = new Set(ROOTS.map(r=>r.idx));
  renderRootChecks();
  index = 0;
  renderCurrent();
});

document.getElementById("rootsNone").addEventListener("click", ()=>{
  selectedRoots = new Set();
  renderRootChecks();
  index = 0;
  renderCurrent();
  if (timerId) stopBtn.click();
});

document.getElementById("qualAll").addEventListener("click", ()=>{
  selectedQuals = new Set(QUALS.map(q=>q.key));
  renderQualChecks();
  index = 0;
  renderCurrent();
});

document.getElementById("qualNone").addEventListener("click", ()=>{
  selectedQuals = new Set();
  renderQualChecks();
  index = 0;
  renderCurrent();
  if (timerId) stopBtn.click();
});

/* ===== åˆæœŸåŒ– ===== */
renderRootChecks();
renderQualChecks();
renderCurrent();
startBtn.classList.remove("is-active");
stopBtn.classList.add("is-stop");
</script>

<footer class="copyright">
  Â© 2026 Ten-CraftWorks. All rights reserved.
</footer>

</body>
</html>
