<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Chord Trainer</title>
  <style>
    body { font-family: system-ui, sans-serif; padding: 24px; }
    h1 { margin: 0 0 14px; }
    .chord { font-size: 72px; font-weight: 800; margin: 16px 0 6px; }

    .row { display: flex; gap: 12px; align-items: center; flex-wrap: wrap; }
    button { padding: 10px 14px; font-size: 16px; cursor: pointer; }
    input[type="range"] { width: 220px; }

    .panel { margin-top: 18px; padding: 14px; border: 1px solid #ddd; border-radius: 12px; }
    .panel h2 { font-size: 16px; margin: 0 0 10px; }
    .checks { display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 8px 12px; }
    .checks label { display: flex; gap: 8px; align-items: center; user-select: none; }
    .hint { font-size: 13px; color: #555; margin-top: 10px; }
    .warn { color: #b00020; font-size: 14px; margin-top: 8px; display:none; }

    .groupHeader { display: flex; align-items: center; gap: 10px; margin: 14px 0 6px; }
    .groupHeader h3 { margin: 0; min-width: 24px; }
    .smallBtn { padding: 6px 10px; font-size: 14px; }

    .diagramWrap { margin: 4px 0 8px; display: flex; align-items: flex-start; gap: 14px; flex-wrap: wrap; }
    .diagramCard { border: 1px solid #ddd; border-radius: 12px; padding: 10px 12px; }
    .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace; }
    .sub { color: #555; font-size: 13px; }
  </style>
</head>
<body>
  <h1>Chord Trainer</h1>

  <div class="row">
    <label>表示秒数: <span id="secLabel">3</span> 秒</label>
    <input id="sec" type="range" min="1" max="10" value="3" />
  </div>

  <div class="chord" id="chord">C</div>

  <div class="diagramWrap">
    <div class="diagramCard" id="diagram"></div>
    <div>
      <div class="sub">押さえ方（E A D G B E）</div>
      <div class="mono" id="shapeText">x 3 2 0 1 0</div>
      <div class="sub" style="margin-top:6px;">※指番号：1=人差し指 / 2=中指 / 3=薬指 / 4=小指</div>
    </div>
  </div>

  <div class="row">
    <button id="start">Start</button>
    <button id="stop" disabled>Stop</button>
    <button id="next">Next</button>
    <label><input type="checkbox" id="random" checked> ランダム</label>
  </div>

  <div class="panel">
    <h2>表示するコードを選ぶ（ルートごと一括ON/OFF）</h2>

    <div class="row" style="margin-bottom:10px;">
      <button id="selectAll" type="button">全選択</button>
      <button id="clearAll" type="button">全解除</button>
    </div>

    <div id="checks"></div>
    <div class="warn" id="warn">⚠️ 1つ以上コードを選んでください</div>
    <div class="hint">※チェックしたコードだけが出題されます（選択は保存されます）</div>
  </div>

  <script>
    // ===== コード定義（ギター標準チューニング：E A D G B E）=====
    // frets: 6弦→1弦（E A D G B E）
    // -1 = ミュート(x), 0 = 開放(0), 1以上 = フレット
    // fingers: 6弦→1弦（0=指定なし）
    // barre: { fret, fromString, toString, finger }  // from/to は 6〜1弦番号
    const CHORD_SHAPES = {
      "C":  { frets:[-1,3,2,0,1,0], fingers:[0,3,2,0,1,0] },
      "Cm": { frets:[-1,3,5,5,4,3], fingers:[0,1,3,4,2,1], barre:{fret:3, fromString:5, toString:1, finger:1} },
      "C7": { frets:[-1,3,2,3,1,0], fingers:[0,3,2,4,1,0] },

      "D":  { frets:[-1,-1,0,2,3,2], fingers:[0,0,0,1,3,2] },
      "Dm": { frets:[-1,-1,0,2,3,1], fingers:[0,0,0,2,3,1] },
      "D7": { frets:[-1,-1,0,2,1,2], fingers:[0,0,0,2,1,3] },

      "E":  { frets:[0,2,2,1,0,0], fingers:[0,2,3,1,0,0] },
      "Em": { frets:[0,2,2,0,0,0], fingers:[0,2,3,0,0,0] },
      "E7": { frets:[0,2,0,1,0,0], fingers:[0,2,0,1,0,0] },

      "F":  { frets:[1,3,3,2,1,1], fingers:[1,3,4,2,1,1], barre:{fret:1, fromString:6, toString:1, finger:1} },
      "Fm": { frets:[1,3,3,1,1,1], fingers:[1,3,4,1,1,1], barre:{fret:1, fromString:6, toString:1, finger:1} },
      "F7": { frets:[1,3,1,2,1,1], fingers:[1,3,1,2,1,1], barre:{fret:1, fromString:6, toString:1, finger:1} },

      "G":  { frets:[3,2,0,0,0,3], fingers:[3,2,0,0,0,4] },
      "Gm": { frets:[3,5,5,3,3,3], fingers:[1,3,4,1,1,1], barre:{fret:3, fromString:6, toString:1, finger:1} },
      "G7": { frets:[3,2,0,0,0,1], fingers:[3,2,0,0,0,1] },

      "A":  { frets:[-1,0,2,2,2,0], fingers:[0,0,1,2,3,0] },
      "Am": { frets:[-1,0,2,2,1,
