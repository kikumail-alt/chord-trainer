<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Chord Trainer</title>

<style>
body {
  font-family: system-ui, sans-serif;
  padding: 24px;
  background-color: #ffffff;
  color: #000000;
}

h1 {
  margin-bottom: 12px;
}

.chord {
  font-size: 64px;
  font-weight: 800;
  margin: 12px 0;
}

.row {
  display: flex;
  gap: 12px;
  align-items: center;
  flex-wrap: wrap;
}

button {
  padding: 8px 12px;
  font-size: 14px;
}

input[type="range"] {
  width: 200px;
}

.panel {
  margin-top: 18px;
  padding: 14px;
  border: 1px solid #ccc;
  border-radius: 12px;
}

.checks {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(110px, 1fr));
  gap: 6px 10px;
}

.groupHeader {
  display: flex;
  align-items: center;
  gap: 8px;
  margin-top: 14px;
}

.smallBtn {
  font-size: 12px;
  padding: 4px 8px;
}

.warn {
  color: #b00020;
  margin-top: 6px;
  display: none;
}

.fbCard {
  border: 1px solid #ccc;
  border-radius: 12px;
  padding: 10px;
}

.sub {
  font-size: 13px;
  color: #555;
}

.mono {
  font-family: monospace;
}

/* ===== ãƒ†ãƒ¼ãƒåˆ‡æ›¿UI ===== */
.theme-switch {
  position: fixed;
  top: 12px;
  right: 12px;
  display: flex;
  gap: 6px;
  z-index: 1000;
}

/* ===== ç™½é»’åè»¢ ===== */
body.theme-dark {
  background-color: #111111;
}

body.theme-dark {
  color: #eeeeee;
}

body.theme-dark .panel,
body.theme-dark .fbCard {
  background-color: #1a1a1a;
}

body.theme-dark button {
  background-color: #222222;
  color: #eeeeee;
}

body.theme-dark svg {
  filter: invert(1) hue-rotate(180deg);
}

/* ===== ä½ã‚³ãƒ³ãƒˆãƒ©ã‚¹ãƒˆ ===== */
body.theme-low {
  background-color: #1e1e1e;
}

body.theme-low {
  color: #cccccc;
}

body.theme-low .panel,
body.theme-low .fbCard {
  background-color: #262626;
}

body.theme-low button {
  background-color: #2f2f2f;
  color: #d0d0d0;
}
</style>
</head>

<body>

<div class="theme-switch">
  <button data-theme="normal">â˜€ï¸ é€šå¸¸</button>
  <button data-theme="dark">ğŸŒ™ ç™½é»’åè»¢</button>
  <button data-theme="low">ğŸŒ˜ ä½ã‚³ãƒ³ãƒˆãƒ©ã‚¹ãƒˆ</button>
</div>

<h1>Chord Trainer</h1>

<div class="row">
  <label>è¡¨ç¤ºç§’æ•° <span id="secLabel">3</span> ç§’</label>
  <input id="sec" type="range" min="1" max="10" value="3">
</div>

<div class="chord" id="chord">C</div>

<div class="fbCard" id="fretboard"></div>
<div class="sub mono" id="shapeText"></div>

<div class="row">
  <button id="start">Start</button>
  <button id="stop" disabled>Stop</button>
  <button id="next">Next</button>
  <label><input type="checkbox" id="random" checked> ãƒ©ãƒ³ãƒ€ãƒ </label>
</div>

<div class="panel">
  <div class="row">
    <button id="selectAll">å…¨é¸æŠ</button>
    <button id="clearAll">å…¨è§£é™¤</button>
  </div>
  <div id="checks"></div>
  <div class="warn" id="warn">âš ï¸ ã‚³ãƒ¼ãƒ‰ã‚’é¸æŠã—ã¦ãã ã•ã„</div>
</div>

<script>
/* ===== ã‚³ãƒ¼ãƒ‰å®šç¾© ===== */
const CHORDS = {
  C:{f:[-1,3,2,0,1,0],g:"C"},
  D:{f:[-1,-1,0,2,3,2],g:"D"},
  E:{f:[0,2,2,1,0,0],g:"E"},
  F:{f:[1,3,3,2,1,1],g:"F"},
  G:{f:[3,2,0,0,0,3],g:"G"},
  A:{f:[-1,0,2,2,2,0],g:"A"},
  Am:{f:[-1,0,2,2,1,0],g:"A"},
  Em:{f:[0,2,2,0,0,0],g:"E"},
  Dm:{f:[-1,-1,0,2,3,1],g:"D"}
};

const GROUPS = {
  C:["C"],
  D:["D","Dm"],
  E:["E","Em"],
  F:["F"],
  G:["G"],
  A:["A","Am"]
};

const ALL = Object.keys(CHORDS);

/* ===== çŠ¶æ…‹ ===== */
let selected = new Set(ALL);
let index = 0;
let timer = null;
let sec = 3;

/* ===== DOM ===== */
const chordEl = document.getElementById("chord");
const fretboardEl = document.getElementById("fretboard");
const shapeTextEl = document.getElementById("shapeText");
const warnEl = document.getElementById("warn");

/* ===== æŒ‡æ¿æç”» ===== */
function drawFretboard(name){
  const f = CHORDS[name].f;
  let svg = `<svg viewBox="0 0 700 160" width="100%">`;
  for(let s=0;s<6;s++){
    let y=30+(5-s)*22;
    svg+=`<line x1="80" y1="${y}" x2="660" y2="${y}" stroke="black"/>`;
  }
  for(let i=0;i<6;i++){
    let x=80+i*96;
    svg+=`<line x1="${x}" y1="30" x2="${x}" y2="140" stroke="black"/>`;
  }
  for(let s=0;s<6;s++){
    if(f[s]>0){
      let cx=80+(f[s]-0.5)*96;
      let cy=30+(5-s)*22;
      svg+=`<circle cx="${cx}" cy="${cy}" r="8" fill="black"/>`;
    }
  }
  svg+=`</svg>`;
  fretboardEl.innerHTML = svg;
  shapeTextEl.textContent = "æŠ¼ã•ãˆæ–¹: " + f.map(v=>v<0?"x":v).join(" ");
}

/* ===== è¡¨ç¤º ===== */
function show(){
  const arr=[...selected];
  if(arr.length===0){
    warnEl.style.display="block";
    return;
  }
  warnEl.style.display="none";
  const name=arr[index%arr.length];
  chordEl.textContent=name;
  drawFretboard(name);
}

/* ===== ãƒã‚§ãƒƒã‚¯UI ===== */
function renderChecks(){
  const wrap=document.getElementById("checks");
  wrap.innerHTML="";
  for(const g in GROUPS){
    const h=document.createElement("div");
    h.className="groupHeader";
    h.innerHTML=`<strong>${g}</strong>`;
    wrap.appendChild(h);
    const c=document.createElement("div");
    c.className="checks";
    GROUPS[g].forEach(k=>{
      const l=document.createElement("label");
      const i=document.createElement("input");
      i.type="checkbox";
      i.checked=selected.has(k);
      i.onchange=()=>{i.checked?selected.add(k):selected.delete(k);show();};
      l.appendChild(i);
      l.append(k);
      c.appendChild(l);
    });
    wrap.appendChild(c);
  }
}

renderChecks();
show();

/* ===== ã‚¿ã‚¤ãƒãƒ¼ ===== */
document.getElementById("sec").oninput=e=>{
  sec=+e.target.value;
  document.getElementById("secLabel").textContent=sec;
};

document.getElementById("start").onclick=()=>{
  if(timer)return;
  timer=setInterval(()=>{index++;show();},sec*1000);
};

document.getElementById("stop").onclick=()=>{
  clearInterval(timer);
  timer=null;
};

/* ===== ãƒ†ãƒ¼ãƒ ===== */
const THEME_KEY="theme";
function applyTheme(t){
  document.body.classList.remove("theme-dark","theme-low");
  if(t==="dark")document.body.classList.add("theme-dark");
  if(t==="low")document.body.classList.add("theme-low");
}
applyTheme(localStorage.getItem(THEME_KEY)||"normal");
document.querySelectorAll(".theme-switch button").forEach(b=>{
  b.onclick=()=>{
    const t=b.dataset.theme;
    localStorage.setItem(THEME_KEY,t);
    applyTheme(t);
  };
});
</script>
</body>
</html>
